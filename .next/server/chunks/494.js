exports.id=494,exports.ids=[494],exports.modules={6627:(a,b,c)=>{"use strict";c.d(b,{CommandPalette:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call CommandPalette() from the server but CommandPalette is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\command-palette.tsx","CommandPalette")},9188:(a,b,c)=>{"use strict";c.d(b,{DropdownMenu:()=>k,DropdownMenuContent:()=>m,DropdownMenuItem:()=>n,DropdownMenuLabel:()=>o,DropdownMenuSeparator:()=>p,DropdownMenuTrigger:()=>l});var d=c(21124),e=c(38301),f=c(51781),g=c(59405),h=c(71613),i=c(90133),j=c(15514);let k=f.bL,l=f.l9;f.YJ,f.ZL,f.Pb,f.z6,e.forwardRef(({className:a,inset:b,children:c,...e},h)=>(0,d.jsxs)(f.ZP,{ref:h,className:(0,j.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",b&&"pl-8",a),...e,children:[c,(0,d.jsx)(g.A,{className:"ml-auto"})]})).displayName=f.ZP.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.G5,{ref:c,className:(0,j.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...b})).displayName=f.G5.displayName;let m=e.forwardRef(({className:a,sideOffset:b=4,...c},e)=>(0,d.jsx)(f.ZL,{children:(0,d.jsx)(f.UC,{ref:e,sideOffset:b,className:(0,j.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...c})}));m.displayName=f.UC.displayName;let n=e.forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(f.q7,{ref:e,className:(0,j.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",b&&"pl-8",a),...c}));n.displayName=f.q7.displayName,e.forwardRef(({className:a,children:b,checked:c,...e},g)=>(0,d.jsxs)(f.H_,{ref:g,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:c,...e,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(f.VF,{children:(0,d.jsx)(h.A,{className:"h-4 w-4"})})}),b]})).displayName=f.H_.displayName,e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.hN,{ref:e,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(f.VF,{children:(0,d.jsx)(i.A,{className:"h-2 w-2 fill-current"})})}),b]})).displayName=f.hN.displayName;let o=e.forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(f.JU,{ref:e,className:(0,j.cn)("px-2 py-1.5 text-sm font-semibold",b&&"pl-8",a),...c}));o.displayName=f.JU.displayName;let p=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.wv,{ref:c,className:(0,j.cn)("-mx-1 my-1 h-px bg-muted",a),...b}));p.displayName=f.wv.displayName},12019:(a,b,c)=>{"use strict";c.d(b,{CommandPalette:()=>w});var d=c(21124),e=c(38301),f=c(42378),g=c(21347),h=c(88285),i=c(15514),j=c(33305);let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(g.uB,{ref:c,className:(0,i.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...b}));k.displayName=g.uB.displayName;let l=({children:a,...b})=>(0,d.jsx)(j.lG,{...b,children:(0,d.jsx)(j.Cf,{className:"overflow-hidden p-0",children:(0,d.jsx)(k,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:a})})}),m=e.forwardRef(({className:a,...b},c)=>(0,d.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,d.jsx)(h.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,d.jsx)(g.uB.Input,{ref:c,className:(0,i.cn)("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...b})]}));m.displayName=g.uB.Input.displayName;let n=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(g.uB.List,{ref:c,className:(0,i.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...b}));n.displayName=g.uB.List.displayName;let o=e.forwardRef((a,b)=>(0,d.jsx)(g.uB.Empty,{ref:b,className:"py-6 text-center text-sm",...a}));o.displayName=g.uB.Empty.displayName;let p=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(g.uB.Group,{ref:c,className:(0,i.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...b}));p.displayName=g.uB.Group.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(g.uB.Separator,{ref:c,className:(0,i.cn)("-mx-1 h-px bg-border",a),...b})).displayName=g.uB.Separator.displayName;let q=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(g.uB.Item,{ref:c,className:(0,i.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a),...b}));q.displayName=g.uB.Item.displayName;var r=c(77850),s=c(65893),t=c(66920),u=c(94684),v=c(46422);function w(){let[a,b]=(0,e.useState)(!1),c=(0,f.useRouter)(),g=a=>{b(!1),c.push(a)};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>b(!0),className:"flex items-center w-full max-w-md px-3 py-2 text-sm text-slate-500 bg-slate-100 dark:bg-slate-800 rounded-md hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[(0,d.jsx)(h.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Search accounts, pages..."}),(0,d.jsxs)("kbd",{className:"ml-auto pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"âŒ˜"}),"K"]})]}),(0,d.jsxs)(l,{open:a,onOpenChange:b,children:[(0,d.jsx)(m,{placeholder:"Type a command or search..."}),(0,d.jsxs)(n,{children:[(0,d.jsx)(o,{children:"No results found."}),(0,d.jsxs)(p,{heading:"Pages",children:[(0,d.jsxs)(q,{onSelect:()=>g("/dashboard/executive"),children:[(0,d.jsx)(r.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Executive Dashboard"})]}),(0,d.jsxs)(q,{onSelect:()=>g("/dashboard/accounts"),children:[(0,d.jsx)(s.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Account360"})]}),(0,d.jsxs)(q,{onSelect:()=>g("/dashboard/journey"),children:[(0,d.jsx)(t.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Customer Journey"})]}),(0,d.jsxs)(q,{onSelect:()=>g("/dashboard/admin"),children:[(0,d.jsx)(u.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Admin Panel"})]}),(0,d.jsxs)(q,{onSelect:()=>g("/dashboard/automation"),children:[(0,d.jsx)(v.A,{className:"mr-2 h-4 w-4"}),(0,d.jsx)("span",{children:"Automation"})]})]})]})]})]})}},15514:(a,b,c)=>{"use strict";c.d(b,{cn:()=>f});var d=c(43249),e=c(58829);function f(...a){return(0,e.QP)((0,d.$)(a))}},18261:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{Ao:()=>y,HB:()=>z,N9:()=>t,ND:()=>m,P4:()=>p,Q1:()=>s,_m:()=>u,hd:()=>n,lw:()=>w,mf:()=>r,o2:()=>o,qO:()=>q,sU:()=>x,xP:()=>A,yW:()=>B,z0:()=>v});var e=c(75879);c(68633);var f=c(27143),g=c(32109),h=c(82161),i=c(16780),j=c(51669),k=a([f,g]);[f,g]=k.then?(await k)():k;let C=/^\d{4}-\d{2}-\d{2}$/;function l(a){if(!a)return{startDate:void 0,endDate:void 0};let b=a=>!!a&&C.test(a)&&!Number.isNaN(new Date(a).getTime()),c=b(a.startDate)?a.startDate:void 0,d=b(a.endDate)?a.endDate:void 0;return c&&d&&new Date(c)>new Date(d)&&(c=void 0,d=void 0),{startDate:c,endDate:d}}async function m(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId);let{startDate:c,endDate:d}=l(a),e=[],i=[];c&&(i.push(c),e.push(`calculated_at::date >= $${i.length}::date`)),d&&(i.push(d),e.push(`calculated_at::date <= $${i.length}::date`));let j=e.length?`WHERE ${e.join(" AND ")}`:"";return(await (0,f.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, calculated_at
      FROM health_scores
      ${j}
      ORDER BY account_id, calculated_at DESC
    ),
    filtered_accounts AS (
      SELECT lh.account_id, lh.overall_score
      FROM latest_health lh
      JOIN accounts a ON lh.account_id = a.id
      WHERE a.parent_id IS NULL
    ),
    totals AS (
      SELECT COUNT(*) AS total FROM filtered_accounts
    )
    SELECT 
      CASE 
        WHEN lh.overall_score >= 70 THEN 'Healthy'
        WHEN lh.overall_score >= 40 THEN 'At Risk'
        ELSE 'Critical'
      END as health_category,
      COUNT(*) as count,
      ROUND(100.0 * COUNT(*) / NULLIF((SELECT total FROM totals), 0), 1) as percentage
    FROM filtered_accounts lh
    CROSS JOIN totals
    GROUP BY health_category, totals.total
    ORDER BY health_category DESC
  `,i)).rows}async function n(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId);let{startDate:c,endDate:d}=l(a),e=[],i=[];c&&(i.push(c),e.push(`calculated_at::date >= $${i.length}::date`)),d&&(i.push(d),e.push(`calculated_at::date <= $${i.length}::date`));let j=e.length?`WHERE ${e.join(" AND ")}`:"";return(await (0,f.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, calculated_at
      FROM health_scores
      ${j}
      ORDER BY account_id, calculated_at DESC
    )
    SELECT 
      a.id,
      a.name,
      a.arr,
      lh.overall_score,
      lh.risk_level,
      p.full_name as csm_name
    FROM accounts a
    JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN profiles p ON a.csm_id = p.id
    WHERE a.arr > 100000
      AND lh.overall_score < 50
      AND a.parent_id IS NULL
    ORDER BY a.arr DESC, lh.overall_score ASC
    LIMIT 10
  `,i)).rows}async function o(a=90,b){let c=await (0,g.Ht)();c||(0,h.redirect)("/login"),await (0,f.Fh)(c.userId);let{startDate:d,endDate:e}=l(b),i=[],j=[];d?(j.push(d),i.push(`jh.entered_at::date >= $${j.length}::date`)):i.push(`jh.entered_at >= NOW() - INTERVAL '${a} days'`),e&&(j.push(e),i.push(`jh.entered_at::date <= $${j.length}::date`));let k=i.length?`WHERE ${i.join(" AND ")}`:"";return(await (0,f.P)(`
    WITH stage_counts AS (
      SELECT 
        DATE(jh.entered_at) as date,
        jh.to_stage as stage,
        COUNT(DISTINCT jh.account_id) as account_count
      FROM journey_history jh
      ${k}
      GROUP BY DATE(jh.entered_at), jh.to_stage
    )
    SELECT 
      date,
      stage::text,
      account_count,
      SUM(account_count) OVER (ORDER BY date) as cumulative_count
    FROM stage_counts
    ORDER BY date DESC
    LIMIT 100
  `,j)).rows}async function p(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId);let{startDate:c,endDate:d}=l(a),e=[],i=[],j=[];c&&(i.push(c),j.push(`calculated_at::date >= $${i.length}::date`)),d&&(i.push(d),j.push(`calculated_at::date <= $${i.length}::date`));let k=j.length?`WHERE ${j.join(" AND ")}`:"";a?.searchTerm&&(i.push(`%${a.searchTerm}%`),e.push(`a.name ILIKE $${i.length}`)),a?.healthFilter&&("Healthy"===a.healthFilter?e.push("lh.overall_score >= 70"):"At Risk"===a.healthFilter?e.push("lh.overall_score >= 40 AND lh.overall_score < 70"):"Critical"===a.healthFilter&&e.push("lh.overall_score < 40")),a?.stageFilter&&(i.push(a.stageFilter),e.push(`ls.to_stage = $${i.length}`));let m=e.length>0?`AND ${e.join(" AND ")}`:"";return(await (0,f.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, usage_score, engagement_score, support_sentiment_score, adoption_score
      FROM health_scores
      ${k}
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT 
      a.id,
      a.name,
      a.parent_id,
      a.hierarchy_level,
      a.hierarchy_path,
      ls.to_stage as current_stage,
      a.crm_attributes,
      a.status,
      lh.overall_score,
      lh.risk_level,
      lh.usage_score,
      lh.engagement_score,
      lh.support_sentiment_score,
      lh.adoption_score,
      pa.name as parent_name,
      u.email as csm_email,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN accounts pa ON a.parent_id = pa.id
    LEFT JOIN users u ON a.csm_id = u.id
    LEFT JOIN profiles p ON u.id = p.id
    WHERE 1=1 ${m}
    ORDER BY a.hierarchy_level, a.name
  `,i)).rows}async function q(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId);let c=await (0,f.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, usage_score, engagement_score, support_sentiment_score, adoption_score, created_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT 
      a.*,
      lh.overall_score,
      lh.risk_level,
      lh.usage_score,
      lh.engagement_score,
      lh.support_sentiment_score,
      lh.adoption_score,
      lh.created_at as health_updated_at,
      ls.to_stage as current_stage,
      pa.name as parent_name,
      u.email as csm_email,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN accounts pa ON a.parent_id = pa.id
    LEFT JOIN users u ON a.csm_id = u.id
    LEFT JOIN profiles p ON u.id = p.id
    WHERE a.id = $1
  `,[a]);if(0===c.rows.length)return null;let d=await (0,f.P)(`
    WITH latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT a.id, a.name, ls.to_stage as current_stage, a.hierarchy_level
    FROM accounts a
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    WHERE a.parent_id = $1
    ORDER BY a.name
  `,[a]),e=await (0,f.P)(`
    SELECT 
      jh.*,
      u.email as changed_by_email
    FROM journey_history jh
    LEFT JOIN users u ON jh.changed_by = u.id
    WHERE jh.account_id = $1
    ORDER BY jh.entered_at DESC
    LIMIT 10
  `,[a]),i=await (0,f.P)(`
    SELECT *
    FROM usage_metrics
    WHERE account_id = $1
    ORDER BY recorded_at DESC
    LIMIT 30
  `,[a]);return{account:c.rows[0],subsidiaries:d.rows,journey:e.rows,metrics:i.rows}}async function r(){let a=await (0,g.Ht)();return a||(0,h.redirect)("/login"),await (0,f.Fh)(a.userId),(await (0,f.P)(`
    SELECT 
      id,
      stage,
      display_name,
      display_name as name,
      display_order,
      target_duration_days,
      color_hex,
      tenant_id,
      is_active,
      created_at
    FROM journey_stages
    ORDER BY display_order
  `)).rows}async function s(){let a=await (0,g.Ht)();a||(0,h.redirect)("/login"),await (0,f.Fh)(a.userId);let b=await (0,f.P)(`
    SELECT DISTINCT ON (id)
      id,
      stage,
      display_name,
      display_name as name,
      display_order,
      target_duration_days,
      color_hex
    FROM journey_stages
    ORDER BY id, display_order
  `),c=await (0,f.P)(`
    WITH latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage, entered_at
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    ),
    latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    )
    SELECT 
      a.id,
      a.name,
      ls.to_stage as current_stage,
      a.arr,
      lh.overall_score,
      lh.risk_level,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN profiles p ON a.csm_id = p.id
    WHERE a.parent_id IS NULL
    ORDER BY ls.to_stage, a.name
  `);return{stages:b.rows,accounts:c.rows}}async function t(a,b,c){let d=await (0,g.Ht)();d||(0,h.redirect)("/login");let e=await (0,f.KU)();try{await e.query("BEGIN"),await (0,f.Fh)(d.userId,e);let g=await e.query("SELECT tenant_id FROM profiles WHERE id = $1",[d.userId]),h=g.rows[0]?.tenant_id;if(!h)throw Error("Unable to resolve tenant for current user");let i=await e.query(`SELECT to_stage FROM journey_history 
       WHERE account_id = $1 
       ORDER BY entered_at DESC 
       LIMIT 1`,[a]),j=i.rows.length>0?i.rows[0].to_stage:null;return j&&await e.query(`
        UPDATE journey_history
        SET exited_at = NOW()
        WHERE account_id = $1 AND to_stage = $2 AND exited_at IS NULL
      `,[a,j]),await e.query(`
      INSERT INTO journey_history (account_id, from_stage, to_stage, changed_by, reason, tenant_id)
      VALUES ($1, $2, $3, $4, $5, $6)
    `,[a,j,b,d.userId,c||"Stage updated via Kanban board",h]),await e.query("COMMIT"),{success:!0}}catch(a){throw await e.query("ROLLBACK"),console.error("Error updating account stage:",a),a}finally{e.release()}}async function u(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login");let c=a.get("name")?.toString().trim(),d=a.get("stage")?.toString(),e=a.get("arr")?.toString(),j=a.get("status")?.toString()||"Active";if(!c||!d)throw Error("Name and stage are required");let k=e?Number(e):null;if(e&&Number.isNaN(k))throw Error("ARR must be a number");let l=await (0,f.KU)();try{await l.query("BEGIN"),await (0,f.Fh)(b.userId,l);let a=await l.query("SELECT tenant_id FROM profiles WHERE id = $1",[b.userId]),e=a.rows[0]?.tenant_id;if(!e)throw Error("Unable to resolve tenant for current user");let g=(await l.query(`INSERT INTO accounts (name, status, arr, tenant_id)
       VALUES ($1, $2, $3, $4)
       RETURNING id`,[c,j,k,e])).rows[0].id;await l.query(`INSERT INTO journey_history (account_id, from_stage, to_stage, entered_at, changed_by, notes, tenant_id)
       VALUES ($1, NULL, $2, NOW(), $3, $4, $5)`,[g,d,b.userId,"Initialized via CS Handbook",e]),await l.query("COMMIT"),(0,i.revalidatePath)("/dashboard/accounts"),(0,i.revalidatePath)("/dashboard/journey"),(0,h.redirect)("/dashboard/accounts")}catch(a){throw await l.query("ROLLBACK"),console.error("Error creating account:",a),a}finally{l.release()}}async function v(a,b){let c=await (0,g.Ht)();c||(0,h.redirect)("/login");let d=[],e=[a],j=1;if(b.name?.trim()&&(d.push(`name = $${++j}`),e.push(b.name)),void 0!==b.arr&&(d.push(`arr = $${++j}`),e.push(b.arr)),b.status&&(d.push(`status = $${++j}`),e.push(b.status)),0===d.length)return{success:!0};let k=await (0,f.KU)();try{return await k.query("BEGIN"),await (0,f.Fh)(c.userId,k),await k.query(`UPDATE accounts SET ${d.join(", ")}, updated_at = NOW() WHERE id = $1`,e),await k.query("COMMIT"),(0,i.revalidatePath)("/dashboard/accounts"),{success:!0}}catch(a){throw await k.query("ROLLBACK"),console.error("Error updating account:",a),a}finally{k.release()}}async function w(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login");let c=await (0,f.KU)();try{return await c.query("BEGIN"),await (0,f.Fh)(b.userId,c),await c.query("DELETE FROM journey_history WHERE account_id = $1",[a]),await c.query("DELETE FROM health_scores WHERE account_id = $1",[a]),await c.query("DELETE FROM accounts WHERE parent_id = $1",[a]),await c.query("DELETE FROM accounts WHERE id = $1",[a]),await c.query("COMMIT"),(0,i.revalidatePath)("/dashboard/accounts"),{success:!0}}catch(a){throw await c.query("ROLLBACK"),console.error("Error deleting account:",a),a}finally{c.release()}}async function x(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login");let c=await (0,f.KU)();try{return await (0,f.Fh)(b.userId,c),(await c.query(`
      SELECT 
        a.*,
        (SELECT to_stage FROM journey_history WHERE account_id = $1 ORDER BY entered_at DESC LIMIT 1) as current_stage,
        (SELECT COUNT(*) FROM journey_history WHERE account_id = $1) as stage_changes,
        (SELECT overall_score FROM health_scores WHERE account_id = $1 ORDER BY calculated_at DESC LIMIT 1) as health_score
      FROM accounts a
      WHERE a.id = $1
    `,[a])).rows[0]||null}finally{c.release()}}async function y(a){let b=await (0,g.Ht)();b||(0,h.redirect)("/login");let c=await (0,f.KU)();try{return await (0,f.Fh)(b.userId,c),(await c.query(`
      SELECT 
        jh.*,
        p.full_name as changed_by_name
      FROM journey_history jh
      LEFT JOIN profiles p ON jh.changed_by = p.id
      WHERE jh.account_id = $1
      ORDER BY jh.entered_at DESC
    `,[a])).rows}finally{c.release()}}async function z(){let a=await (0,g.Ht)();return a||(0,h.redirect)("/login"),await (0,f.Fh)(a.userId),(await (0,f.P)(`
    SELECT 
      p.*,
      COUNT(pe.id) as total_executions,
      COUNT(CASE WHEN pe.executed_at >= NOW() - INTERVAL '7 days' THEN 1 END) as executions_last_7_days,
      MAX(pe.executed_at) as last_executed_at
    FROM playbooks p
    LEFT JOIN playbook_executions pe ON p.id = pe.playbook_id
    WHERE p.is_active = true
    GROUP BY p.id
    ORDER BY p.name
  `)).rows}async function A(a=50){let b=await (0,g.Ht)();return b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId),(await (0,f.P)(`
    SELECT 
      wq.*,
      p.name as playbook_name,
      a.name as account_name
    FROM webhook_queue wq
    LEFT JOIN playbooks p ON wq.playbook_id = p.id
    LEFT JOIN accounts a ON (wq.payload->>'account_id')::uuid = a.id
    ORDER BY wq.created_at DESC
    LIMIT $1
  `,[a])).rows}async function B(a=5){let b=await (0,g.Ht)();return b||(0,h.redirect)("/login"),await (0,f.Fh)(b.userId),(await (0,f.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id) 
        account_id, overall_score, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage, entered_at
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT
      a.id,
      a.name,
      ls.to_stage as current_stage,
      lh.overall_score,
      ls.entered_at as last_activity
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    WHERE a.parent_id IS NULL
    ORDER BY ls.entered_at DESC NULLS LAST
    LIMIT $1
  `,[a])).rows}(0,j.D)([m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B]),(0,e.A)(m,"408db9863caa72095816bcf1823bb20278b92b49f6",null),(0,e.A)(n,"405e8e943fd33c6fab8c8d425b0d0c408126507924",null),(0,e.A)(o,"609a24f87fee4b3ca559ad1c21f64534d1838f6e4a",null),(0,e.A)(p,"4058e4eedf37ad9ea7284e224195db07d6e76515ab",null),(0,e.A)(q,"4032e617fa50a4046b330fb49f493bf832839b26e2",null),(0,e.A)(r,"00f9bf7ebb524526964cc9b40c980564aa908a7931",null),(0,e.A)(s,"003583416e87b251e33ce882594462a66d58ec43c9",null),(0,e.A)(t,"70b54de73cc768597933a251865628f27c19fddd19",null),(0,e.A)(u,"40d851cb6a26ab04adc2b35b3947d3159ce4b6321b",null),(0,e.A)(v,"60ec41137af5e7a75705fef719b2e466548c844d69",null),(0,e.A)(w,"40fc687fc268beaf70156c41a51322256b9b415907",null),(0,e.A)(x,"40df15242f885ada9a1dd36a28fad40cf403326729",null),(0,e.A)(y,"40cd7b2b3cacb9264c695a38d1f31097064af56183",null),(0,e.A)(z,"0035f80d577deaf627a2535a76284d8300e80aef06",null),(0,e.A)(A,"400754bc52311390ac22d9ee449ca23223e7f3485f",null),(0,e.A)(B,"40cc5f5ee0050487b8e092fc7239b9104a3ea934bf",null),d()}catch(a){d(a)}})},19375:(a,b,c)=>{Promise.resolve().then(c.bind(c,12019)),Promise.resolve().then(c.bind(c,9188)),Promise.resolve().then(c.t.bind(c,3991,23))},20414:(a,b,c)=>{"use strict";c.d(b,{DropdownMenu:()=>e,DropdownMenuContent:()=>g,DropdownMenuItem:()=>h,DropdownMenuLabel:()=>i,DropdownMenuSeparator:()=>j,DropdownMenuTrigger:()=>f});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenu() from the server but DropdownMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenu"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuTrigger() from the server but DropdownMenuTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuTrigger"),g=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuContent() from the server but DropdownMenuContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuContent"),h=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuItem() from the server but DropdownMenuItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuItem");(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuCheckboxItem() from the server but DropdownMenuCheckboxItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuCheckboxItem"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuRadioItem() from the server but DropdownMenuRadioItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuRadioItem");let i=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuLabel() from the server but DropdownMenuLabel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuLabel"),j=(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSeparator() from the server but DropdownMenuSeparator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuSeparator");(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuShortcut() from the server but DropdownMenuShortcut is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuShortcut"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuGroup() from the server but DropdownMenuGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuGroup"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuPortal() from the server but DropdownMenuPortal is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuPortal"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSub() from the server but DropdownMenuSub is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuSub"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSubContent() from the server but DropdownMenuSubContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuSubContent"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSubTrigger() from the server but DropdownMenuSubTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuSubTrigger"),(0,d.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuRadioGroup() from the server but DropdownMenuRadioGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bala Karumanchi\\OneDrive - QuNulabs Private Limited\\Desktop\\Aro-Desk\\components\\ui\\dropdown-menu.tsx","DropdownMenuRadioGroup")},33305:(a,b,c)=>{"use strict";c.d(b,{Cf:()=>m,L3:()=>o,c7:()=>n,lG:()=>i,rr:()=>p,zM:()=>j});var d=c(21124),e=c(38301),f=c(99405),g=c(47089),h=c(15514);let i=f.bL,j=f.l9,k=f.ZL;f.bm;let l=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hJ,{ref:c,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b}));l.displayName=f.hJ.displayName;let m=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(k,{children:[(0,d.jsx)(l,{}),(0,d.jsxs)(f.UC,{ref:e,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[b,(0,d.jsxs)(f.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,d.jsx)(g.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=f.UC.displayName;let n=({className:a,...b})=>(0,d.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...b});n.displayName="DialogHeader";let o=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hE,{ref:c,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...b}));o.displayName=f.hE.displayName;let p=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.VY,{ref:c,className:(0,h.cn)("text-sm text-muted-foreground",a),...b}));p.displayName=f.VY.displayName},66231:(a,b,c)=>{Promise.resolve().then(c.bind(c,6627)),Promise.resolve().then(c.bind(c,20414)),Promise.resolve().then(c.t.bind(c,65169,23))},69694:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>y});var e=c(75338),f=c(82161),g=c(32109),h=c(31258),i=c(18261),j=c(15708),k=c(73515),l=c(41442),m=c(73842),n=c(5794),o=c(38708),p=c(57772),q=c(73627),r=c(33358),s=c(844),t=c(65169),u=c.n(t),v=c(20414),w=c(6627),x=a([g,h,i]);[g,h,i]=x.then?(await x)():x;let z=[{name:"Executive Dashboard",href:"/dashboard/executive",icon:j.A},{name:"Account360",href:"/dashboard/accounts",icon:k.A},{name:"Customer Journey",href:"/dashboard/journey",icon:l.A},{name:"Integrations",href:"/dashboard/integrations",icon:m.A},{name:"CS Handbook",href:"/dashboard/admin",icon:n.A},{name:"Automation",href:"/dashboard/automation",icon:o.A}];async function y({children:a}){let b=await (0,g.VM)(),c=await (0,h.jm)();b||(0,f.redirect)("/login");let d=await (0,i.yW)();return(0,e.jsxs)("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900",children:[(0,e.jsxs)("aside",{className:"w-64 border-r bg-white dark:bg-slate-800 flex flex-col",children:[(0,e.jsxs)("div",{className:"h-16 border-b flex items-center px-6",children:[(0,e.jsx)(p.A,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,e.jsx)("span",{className:"font-bold text-lg",children:"CS Platform"})]}),(0,e.jsxs)("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:[z.map(a=>(0,e.jsxs)(u(),{href:a.href,className:"flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 transition-colors",children:[(0,e.jsx)(a.icon,{className:"mr-3 h-5 w-5"}),a.name]},a.name)),(0,e.jsxs)("div",{className:"pt-6",children:[(0,e.jsx)("div",{className:"px-3 mb-2 flex items-center justify-between",children:(0,e.jsx)("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Recent Accounts"})}),(0,e.jsx)("div",{className:"space-y-1",children:d.map(a=>(0,e.jsxs)(u(),{href:`/dashboard/accounts/${a.id}`,className:"flex items-center px-3 py-2 text-sm rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors group",children:[(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 truncate",children:a.name}),(0,e.jsx)("p",{className:"text-xs text-slate-500 truncate",children:a.current_stage})]}),(0,e.jsx)("div",{className:`ml-2 flex-shrink-0 w-2 h-2 rounded-full ${a.overall_score>=70?"bg-green-500":a.overall_score>=40?"bg-yellow-500":"bg-red-500"}`})]},a.id))})]})]}),(0,e.jsx)("div",{className:"border-t p-4",children:(0,e.jsxs)(v.DropdownMenu,{children:[(0,e.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,e.jsxs)("button",{className:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[(0,e.jsxs)("div",{className:"flex-1 text-left",children:[(0,e.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:b.full_name}),(0,e.jsx)("p",{className:"text-xs text-slate-500",children:b.role})]}),(0,e.jsx)(q.A,{className:"h-4 w-4 text-slate-400"})]})}),(0,e.jsxs)(v.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,e.jsx)(v.DropdownMenuLabel,{children:(0,e.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:b.full_name}),(0,e.jsx)("p",{className:"text-xs text-muted-foreground",children:b.tenant?.name})]})}),(0,e.jsx)(v.DropdownMenuSeparator,{}),c&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.DropdownMenuItem,{asChild:!0,children:(0,e.jsxs)(u(),{href:"/admin",className:"flex items-center",children:[(0,e.jsx)(r.A,{className:"mr-2 h-4 w-4"}),(0,e.jsx)("span",{children:"CS Handbook"})]})}),(0,e.jsx)(v.DropdownMenuSeparator,{})]}),(0,e.jsx)(v.DropdownMenuItem,{asChild:!0,children:(0,e.jsx)("form",{action:g.Kd,className:"w-full",children:(0,e.jsxs)("button",{type:"submit",className:"flex items-center w-full",children:[(0,e.jsx)(s.A,{className:"mr-2 h-4 w-4"}),(0,e.jsx)("span",{children:"Sign out"})]})})})]})]})})]}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsxs)("header",{className:"h-16 border-b bg-white dark:bg-slate-800 flex items-center px-6",children:[(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(w.CommandPalette,{})}),(0,e.jsx)("div",{className:"ml-4",children:(0,e.jsxs)("div",{className:"flex items-center px-3 py-1.5 text-sm bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-md",children:[(0,e.jsx)(p.A,{className:"h-4 w-4 mr-2"}),b.tenant?.name]})})]}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto",children:a})]})]})}d()}catch(a){d(a)}})}};