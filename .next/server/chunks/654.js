"use strict";exports.id=654,exports.ids=[654],exports.modules={63919:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.r(a),t.d(a,{"0004aa8566c1f3e312cb7f3e3813d6157b8fb58a8b":()=>c.VM,"005425e0a812709ce540c323e485343a1ac42fce8e":()=>r.Q1,"007c7f942aadb8dbc8cc2b6b30f60982431f70127f":()=>c.Kd,"009a4985819b97b4be2fe1cdb32c9df11877379ad4":()=>c.Ht,"00c51daf9dff5a256b21999797c4e988b3e5114375":()=>r.HB,"00dc1677d24c5ceadcc7273a31ef52a63def6788d0":()=>r.mf,"00ead3778c23c3e90f901e9d252fe9e3c547ab5c2f":()=>d.Y2,"402950729f574cd9671c0cabe09d6b2f7bc109631e":()=>r.P4,"402d0d22c145eada57fb25e0c590e564864c8c79b2":()=>r.qO,"404277a33f7cb0ce1f7247add59deea9a766c2d7db":()=>c.Lz,"4093bdb8f9923b65bea1b9908ed9872da6cc3f4090":()=>d.Rc,"40982a859ec3c46a1b6607285e686490468d9e8108":()=>c.zP,"40a26f5e0a796fc4965d4d28aa51508a107d704968":()=>r.xP,"40ac348b21dd335ce9d63d26c1939b25abc541f965":()=>r.yW,"40b79742bcbf00dfdf85e2af52cbbed0924121a839":()=>r.ND,"40bd541fc16e4b03c33c1297531f2e89d59c364b4e":()=>c.RX,"40d207086f72aa7cb1621be81c24798bad5b586c2b":()=>d.Ah,"40d355824c03bd8e1cb0730e5dd1e86a630707aa5b":()=>r.hd,"40e4a2c0277d8e53f8acfa3d542acbfbe508cc5bdb":()=>d.fh,"60518e0904e688100c75bead343abdd23a6fd47546":()=>d.yS,"606f5e31091adc80a1be1e6fef02e80ee17571be5b":()=>d.q2,"6079da059912d42e8f711c22146af9bcb6f669a503":()=>d._J,"60801f958c5c2cd740f6d50ccb360f01b5977ffb89":()=>d.D4,"608c42a796b1bf12ec0a4ee124c2f68213455f2758":()=>r.o2,"609bb479b0824e844c27b0da1b7903dd2618d678ab":()=>d.h,"60aa7deae1438831c2aa98764bbb3e8952eeb676ef":()=>d.MM,"60c10c2f7698161b318490e7090af54590968be6b7":()=>d.pv,"60ddf7adaf1edf022c320c2458591c4c5aea76eb24":()=>d.ZC,"60ecf9a3b9cb0b1e74ed2174b4c9e4cc3284578064":()=>d.i2,"60fc0de2396f1bf30413895e161bc378eb7eec69a0":()=>d.om,"7028ac6fdb9c7f6a8133943fa186626dc90a4e548d":()=>d.FW,"7072ec0fd8e05dec8f794bba20fc648a78e5f8a6a6":()=>d.jZ,"70d502ab1ee2046d48b5b61eec9c7acffedf7bbd95":()=>r.N9,"781d81b4684a353e3dd7a22ff116e62aa791775717":()=>d.Xy,"78e2337010800ea260f333d67d15ed59b23570ec27":()=>d.Vi,"78f9fb0db4ce705d16028b13263ca29d9204fa2cf7":()=>d.C5,"7ca563f4d206600ac459885c025853b24f57080993":()=>d.Hu,"7e513cda3da4bba4cde798e269d7d79ef89c5ca15c":()=>d.GG});var c=t(35603),r=t(13311),d=t(66471),i=e([c,r,d]);[c,r,d]=i.then?(await i)():i,n()}catch(e){n(e)}})},66471:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Ah:()=>R,C5:()=>N,D4:()=>I,FW:()=>m,GG:()=>u,Hu:()=>p,MM:()=>S,Rc:()=>g,Vi:()=>E,Xy:()=>_,Y2:()=>h,ZC:()=>o,_J:()=>$,fh:()=>T,h:()=>l,i2:()=>f,jZ:()=>w,om:()=>b,pv:()=>y,q2:()=>O,yS:()=>A});var c=t(88977);t(98063);var r=t(62545),d=t(44481),i=t(56215),s=e([r]);async function o(e,a){let t=`
    INSERT INTO lifecycle_stages (tenant_id, name, weights)
    VALUES (current_tenant_id(), $1, $2::jsonb)
    ON CONFLICT (tenant_id, name)
    DO UPDATE SET weights = EXCLUDED.weights, updated_at = NOW()
    RETURNING id, name, weights
  `;return(await (0,r.P)(t,[e,JSON.stringify(a)])).rows[0]}async function u(e,a,t,n,c,d){let i=await (0,r.P)("SELECT weights FROM lifecycle_stages WHERE tenant_id = current_tenant_id() AND name = $1 AND is_active = true",[a]),s=i.rows[0]?.weights||{usage_frequency:.4,breadth:.3,depth:.3},o=Number(t.usage_frequency||0),u=Number(t.breadth||0),f=Number(t.depth||0),b=o*Number(s.usage_frequency||0)+u*Number(s.breadth||0)+f*Number(s.depth||0),l=await (0,r.P)("SELECT score FROM health_scores WHERE tenant_id = current_tenant_id() AND account_id = $1 ORDER BY window_end DESC LIMIT 1",[e]),_=l.rows[0]?Number(b)-Number(l.rows[0].score):null,E=`
    INSERT INTO health_scores (tenant_id, account_id, stage, score, metrics, window_start, window_end, trend, notes)
    VALUES (current_tenant_id(), $1, $2, $3, $4::jsonb, $5, $6, $7, $8)
    RETURNING id, score, trend
  `,y=await (0,r.P)(E,[e,a,b,JSON.stringify(t),n,c,_,d||null]);return null!==_&&_<-.1&&await (0,r.P)("INSERT INTO alerts (tenant_id, account_id, alert_type, severity, message, context) VALUES (current_tenant_id(), $1, $2, $3, $4, $5::jsonb)",[e,"health_dip","warning","Health score decreased",JSON.stringify({stage:a,score:b,trend:_})]),y.rows[0]}async function f(e,a=12){return(await (0,r.P)(`SELECT 
       COALESCE(window_end, calculated_at, created_at) AS window_end,
       COALESCE(score, overall_score) AS score,
       trend,
       stage
     FROM health_scores
     WHERE tenant_id = current_tenant_id() AND account_id = $1
     ORDER BY COALESCE(window_end, calculated_at, created_at) DESC
     LIMIT $2`,[e,a])).rows}async function b(e,a=12){return(await (0,r.P)(`SELECT
       COALESCE(window_end, calculated_at, created_at) AS window_end,
       usage_score,
       engagement_score,
       support_sentiment_score,
       adoption_score
     FROM health_scores
     WHERE tenant_id = current_tenant_id() AND account_id = $1
     ORDER BY COALESCE(window_end, calculated_at, created_at) DESC
     LIMIT $2`,[e,a])).rows}async function l(e,a){let t=[];for(let n of a){let a=await (0,d.G)(n.text),c=a.label||(a.score<-.2?"negative":a.score>.2?"positive":"neutral"),i=`
      INSERT INTO sentiment_analyses (tenant_id, account_id, source_type, source_id, sentiment_score, magnitude, label, summary, language)
      VALUES (current_tenant_id(), $1, $2, $3, $4, $5, $6, $7, $8)
      ON CONFLICT (tenant_id, source_type, source_id)
      DO UPDATE SET sentiment_score = EXCLUDED.sentiment_score, magnitude = EXCLUDED.magnitude, label = EXCLUDED.label, summary = EXCLUDED.summary
      RETURNING id
    `,s=await (0,r.P)(i,[e,n.source_type,n.source_id,a.score,a.magnitude||null,c,a.summary||null,n.language||a.language||"en"]);t.push({id:s.rows[0].id,label:c,score:a.score}),a.score<-.4&&await (0,r.P)("INSERT INTO alerts (tenant_id, account_id, alert_type, severity, message, context) VALUES (current_tenant_id(), $1, $2, $3, $4, $5::jsonb)",[e,"sentiment_negative","warning","Negative sentiment detected",JSON.stringify({source_type:n.source_type,source_id:n.source_id,score:a.score})])}return t}async function _(e,a,t,n){return(await (0,r.P)("INSERT INTO success_plans (tenant_id, account_id, name, target_date, attributes) VALUES (current_tenant_id(), $1, $2, $3, $4::jsonb) RETURNING id",[e,a,t||null,JSON.stringify(n||{})])).rows[0]}async function E(e,a,t,n){return(await (0,r.P)("INSERT INTO success_plan_steps (tenant_id, plan_id, title, due_date, assignee_user_id) VALUES (current_tenant_id(), $1, $2, $3, $4) RETURNING id",[e,a,t||null,n||null])).rows[0]}async function y(e,a){return await (0,r.P)("UPDATE success_plan_steps SET status = $1, updated_at = NOW() WHERE id = $2 AND tenant_id = current_tenant_id()",[a,e]),{ok:!0}}async function N(e,a,t,n){return(await (0,r.P)("INSERT INTO playbooks (tenant_id, name, scenario_key, triggers, actions) VALUES (current_tenant_id(), $1, $2, $3::jsonb, $4::jsonb) RETURNING id",[e,a,JSON.stringify(t),JSON.stringify(n)])).rows[0]}async function w(e,a,t="system"){let n=await (0,r.P)("SELECT actions FROM playbooks WHERE id = $1 AND tenant_id = current_tenant_id() AND is_active = true",[e]);if(!n.rows[0])return{error:"Playbook not found or inactive"};let c=n.rows[0].actions;return{id:(await (0,r.P)("INSERT INTO playbook_runs (tenant_id, playbook_id, account_id, status, triggered_by, result) VALUES (current_tenant_id(), $1, $2, $3, $4, $5::jsonb) RETURNING id",[e,a,"completed",t,JSON.stringify({actions_executed:c})])).rows[0].id,actions:c}}async function p(e,a,t,n,c){return await (0,r.P)("INSERT INTO cdi_events (tenant_id, account_id, source_type, event_type, payload, occurred_at) VALUES (current_tenant_id(), $1, $2, $3, $4::jsonb, $5)",[e,a,t,JSON.stringify(n),c]),{ok:!0}}async function m(e,a,t){let n=await (0,d.g)(t);return{id:(await (0,r.P)("INSERT INTO ai_workflow_runs (tenant_id, workflow_id, account_id, input, output, status, started_at, completed_at) VALUES (current_tenant_id(), $1, $2, $3::jsonb, $4::jsonb, $5, NOW(), NOW()) RETURNING id",[e,a,JSON.stringify(t),JSON.stringify({email_body:n}),"completed"])).rows[0].id,email_body:n}}async function R(e){return(await (0,r.P)("SELECT * FROM success_plans WHERE tenant_id = current_tenant_id() AND account_id = $1 ORDER BY created_at DESC",[e])).rows}async function g(e){return(await (0,r.P)("SELECT * FROM success_plan_steps WHERE tenant_id = current_tenant_id() AND plan_id = $1 ORDER BY sort_order, created_at",[e])).rows}async function $(e,a=20){return(await (0,r.P)("SELECT * FROM alerts WHERE tenant_id = current_tenant_id() AND account_id = $1 ORDER BY created_at DESC LIMIT $2",[e,a])).rows}async function S(e,a=50){return(await (0,r.P)("SELECT * FROM sentiment_analyses WHERE tenant_id = current_tenant_id() AND account_id = $1 ORDER BY created_at DESC LIMIT $2",[e,a])).rows}async function O(e,a=50){return(await (0,r.P)("SELECT * FROM cdi_events WHERE tenant_id = current_tenant_id() AND account_id = $1 ORDER BY occurred_at DESC LIMIT $2",[e,a])).rows}async function A(e,a=20){return(await (0,r.P)("SELECT pr.*, pb.name AS playbook_name FROM playbook_runs pr LEFT JOIN playbooks pb ON pr.playbook_id = pb.id WHERE pr.tenant_id = current_tenant_id() AND pr.account_id = $1 ORDER BY pr.created_at DESC LIMIT $2",[e,a])).rows}async function T(e=20){return(await (0,r.P)("SELECT e.*, a.name AS account_name FROM cdi_events e LEFT JOIN accounts a ON e.account_id = a.id WHERE e.tenant_id = current_tenant_id() ORDER BY e.occurred_at DESC LIMIT $1",[e])).rows}async function h(){let e=await (0,r.P)("SELECT id FROM ai_workflows WHERE tenant_id = current_tenant_id() AND is_active = true ORDER BY updated_at DESC LIMIT 1");return e.rows[0]?.id||null}async function I(e,a){let t=await h();return t?m(t,e,a):{error:"No active AI workflow configured"}}r=(s.then?(await s)():s)[0],(0,i.D)([o,u,f,b,l,_,E,y,N,w,p,m,R,g,$,S,O,A,T,h,I]),(0,c.A)(o,"60ddf7adaf1edf022c320c2458591c4c5aea76eb24",null),(0,c.A)(u,"7e513cda3da4bba4cde798e269d7d79ef89c5ca15c",null),(0,c.A)(f,"60ecf9a3b9cb0b1e74ed2174b4c9e4cc3284578064",null),(0,c.A)(b,"60fc0de2396f1bf30413895e161bc378eb7eec69a0",null),(0,c.A)(l,"609bb479b0824e844c27b0da1b7903dd2618d678ab",null),(0,c.A)(_,"781d81b4684a353e3dd7a22ff116e62aa791775717",null),(0,c.A)(E,"78e2337010800ea260f333d67d15ed59b23570ec27",null),(0,c.A)(y,"60c10c2f7698161b318490e7090af54590968be6b7",null),(0,c.A)(N,"78f9fb0db4ce705d16028b13263ca29d9204fa2cf7",null),(0,c.A)(w,"7072ec0fd8e05dec8f794bba20fc648a78e5f8a6a6",null),(0,c.A)(p,"7ca563f4d206600ac459885c025853b24f57080993",null),(0,c.A)(m,"7028ac6fdb9c7f6a8133943fa186626dc90a4e548d",null),(0,c.A)(R,"40d207086f72aa7cb1621be81c24798bad5b586c2b",null),(0,c.A)(g,"4093bdb8f9923b65bea1b9908ed9872da6cc3f4090",null),(0,c.A)($,"6079da059912d42e8f711c22146af9bcb6f669a503",null),(0,c.A)(S,"60aa7deae1438831c2aa98764bbb3e8952eeb676ef",null),(0,c.A)(O,"606f5e31091adc80a1be1e6fef02e80ee17571be5b",null),(0,c.A)(A,"60518e0904e688100c75bead343abdd23a6fd47546",null),(0,c.A)(T,"40e4a2c0277d8e53f8acfa3d542acbfbe508cc5bdb",null),(0,c.A)(h,"00ead3778c23c3e90f901e9d252fe9e3c547ab5c2f",null),(0,c.A)(I,"60801f958c5c2cd740f6d50ccb360f01b5977ffb89",null),n()}catch(e){n(e)}})},52216:(e,a,t)=>{t.d(a,{E:()=>i});var n=t(62740);t(76301);var c=t(67699),r=t(55946);let d=(0,c.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:a,...t}){return(0,n.jsx)("div",{className:(0,r.cn)(d({variant:a}),e),...t})}},19935:(e,a,t)=>{t.d(a,{BT:()=>o,Wu:()=>u,ZB:()=>s,Zp:()=>d,aR:()=>i});var n=t(62740),c=t(76301),r=t(55946);let d=c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("div",{ref:t,className:(0,r.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...a}));d.displayName="Card";let i=c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...a}));i.displayName="CardHeader";let s=c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("h3",{ref:t,className:(0,r.cn)("font-semibold leading-none tracking-tight",e),...a}));s.displayName="CardTitle";let o=c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));o.displayName="CardDescription";let u=c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",e),...a}));u.displayName="CardContent",c.forwardRef(({className:e,...a},t)=>(0,n.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},44481:(e,a,t)=>{async function n(e,a){let t=process.env.OPENAI_API_KEY;if(!t)throw Error("OPENAI_API_KEY is not set");let n={model:process.env.OPENAI_MODEL||"gpt-4.1-mini",messages:[a?{role:"system",content:a}:void 0,{role:"user",content:e}].filter(Boolean),temperature:.2},c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(!c.ok){let e=await c.text();throw Error(`OpenAI error: ${c.status} ${e}`)}return await c.json()}async function c(e){let a=`Text:
${e}

Return strict JSON.`,t=await n(a,"You analyze customer success text for sentiment. Return JSON with keys: score (-1..1), magnitude (0..inf), label (negative|neutral|positive), summary, language."),c=t.choices?.[0]?.message?.content||"{}";try{return JSON.parse(c)}catch{return{score:0,label:"neutral",summary:"Unable to parse",language:"en"}}}async function r(e){let a=`Context: ${JSON.stringify(e)}

Write the email body only.`,t=await n(a,"You are a Customer Success assistant. Write concise, friendly follow-up emails that are actionable.");return t.choices?.[0]?.message?.content||""}t.d(a,{G:()=>c,g:()=>r})},55946:(e,a,t)=>{t.d(a,{cn:()=>r});var n=t(13673),c=t(47317);function r(...e){return(0,c.QP)((0,n.$)(e))}},68165:(e,a,t)=>{t.d(a,{A:()=>n});let n=(0,t(83238).A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])}};