exports.id=226,exports.ids=[226],exports.modules={2636:(e,t,a)=>{Promise.resolve().then(a.bind(a,85)),Promise.resolve().then(a.bind(a,93260)),Promise.resolve().then(a.t.bind(a,59607,23))},8716:(e,t,a)=>{Promise.resolve().then(a.bind(a,91500)),Promise.resolve().then(a.bind(a,12952)),Promise.resolve().then(a.t.bind(a,28531,23))},82952:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,13219,23)),Promise.resolve().then(a.t.bind(a,34863,23)),Promise.resolve().then(a.t.bind(a,25155,23)),Promise.resolve().then(a.t.bind(a,40802,23)),Promise.resolve().then(a.t.bind(a,9350,23)),Promise.resolve().then(a.t.bind(a,48530,23)),Promise.resolve().then(a.t.bind(a,88921,23))},46504:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,66959,23)),Promise.resolve().then(a.t.bind(a,33875,23)),Promise.resolve().then(a.t.bind(a,88903,23)),Promise.resolve().then(a.t.bind(a,57174,23)),Promise.resolve().then(a.t.bind(a,84178,23)),Promise.resolve().then(a.t.bind(a,87190,23)),Promise.resolve().then(a.t.bind(a,61365,23))},5939:()=>{},363:()=>{},91500:(e,t,a)=>{"use strict";a.d(t,{CommandPalette:()=>E});var n=a(45512),o=a(58009),r=a(79334),s=a(85748),l=a(16873),i=a(59462),d=a(71965);let c=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(s.uB,{ref:a,className:(0,i.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));c.displayName=s.uB.displayName;let u=({children:e,...t})=>(0,n.jsx)(d.lG,{...t,children:(0,n.jsx)(d.Cf,{className:"overflow-hidden p-0",children:(0,n.jsx)(c,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:e})})}),m=o.forwardRef(({className:e,...t},a)=>(0,n.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,n.jsx)(l.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,n.jsx)(s.uB.Input,{ref:a,className:(0,i.cn)("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));m.displayName=s.uB.Input.displayName;let p=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(s.uB.List,{ref:a,className:(0,i.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));p.displayName=s.uB.List.displayName;let h=o.forwardRef((e,t)=>(0,n.jsx)(s.uB.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));h.displayName=s.uB.Empty.displayName;let f=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(s.uB.Group,{ref:a,className:(0,i.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));f.displayName=s.uB.Group.displayName,o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(s.uB.Separator,{ref:a,className:(0,i.cn)("-mx-1 h-px bg-border",e),...t})).displayName=s.uB.Separator.displayName;let _=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(s.uB.Item,{ref:a,className:(0,i.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...t}));_.displayName=s.uB.Item.displayName;var x=a(80574),w=a(64977),g=a(69988),b=a(94520),N=a(26658);function E(){let[e,t]=(0,o.useState)(!1),a=(0,r.useRouter)(),s=e=>{t(!1),a.push(e)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{onClick:()=>t(!0),className:"flex items-center w-full max-w-md px-3 py-2 text-sm text-slate-500 bg-slate-100 dark:bg-slate-800 rounded-md hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[(0,n.jsx)(l.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Search accounts, pages..."}),(0,n.jsxs)("kbd",{className:"ml-auto pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,n.jsx)("span",{className:"text-xs",children:"âŒ˜"}),"K"]})]}),(0,n.jsxs)(u,{open:e,onOpenChange:t,children:[(0,n.jsx)(m,{placeholder:"Type a command or search..."}),(0,n.jsxs)(p,{children:[(0,n.jsx)(h,{children:"No results found."}),(0,n.jsxs)(f,{heading:"Pages",children:[(0,n.jsxs)(_,{onSelect:()=>s("/dashboard/executive"),children:[(0,n.jsx)(x.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Executive Dashboard"})]}),(0,n.jsxs)(_,{onSelect:()=>s("/dashboard/accounts"),children:[(0,n.jsx)(w.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Account360"})]}),(0,n.jsxs)(_,{onSelect:()=>s("/dashboard/journey"),children:[(0,n.jsx)(g.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Customer Journey"})]}),(0,n.jsxs)(_,{onSelect:()=>s("/dashboard/admin"),children:[(0,n.jsx)(b.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Admin Panel"})]}),(0,n.jsxs)(_,{onSelect:()=>s("/dashboard/automation"),children:[(0,n.jsx)(N.A,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Automation"})]})]})]})]})]})}},71965:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>m,L3:()=>h,c7:()=>p,lG:()=>i,rr:()=>f,zM:()=>d});var n=a(45512),o=a(58009),r=a(39258),s=a(44269),l=a(59462);let i=r.bL,d=r.l9,c=r.ZL;r.bm;let u=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(r.hJ,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=r.hJ.displayName;let m=o.forwardRef(({className:e,children:t,...a},o)=>(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(r.UC,{ref:o,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[t,(0,n.jsxs)(r.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(s.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=r.UC.displayName;let p=({className:e,...t})=>(0,n.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let h=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(r.hE,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));h.displayName=r.hE.displayName;let f=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(r.VY,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));f.displayName=r.VY.displayName},12952:(e,t,a)=>{"use strict";a.d(t,{DropdownMenu:()=>c,DropdownMenuContent:()=>m,DropdownMenuItem:()=>p,DropdownMenuLabel:()=>h,DropdownMenuSeparator:()=>f,DropdownMenuTrigger:()=>u});var n=a(45512),o=a(58009),r=a(54976),s=a(99905),l=a(24849),i=a(63689),d=a(59462);let c=r.bL,u=r.l9;r.YJ,r.ZL,r.Pb,r.z6,o.forwardRef(({className:e,inset:t,children:a,...o},l)=>(0,n.jsxs)(r.ZP,{ref:l,className:(0,d.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...o,children:[a,(0,n.jsx)(s.A,{className:"ml-auto"})]})).displayName=r.ZP.displayName,o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(r.G5,{ref:a,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...t})).displayName=r.G5.displayName;let m=o.forwardRef(({className:e,sideOffset:t=4,...a},o)=>(0,n.jsx)(r.ZL,{children:(0,n.jsx)(r.UC,{ref:o,sideOffset:t,className:(0,d.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...a})}));m.displayName=r.UC.displayName;let p=o.forwardRef(({className:e,inset:t,...a},o)=>(0,n.jsx)(r.q7,{ref:o,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",e),...a}));p.displayName=r.q7.displayName,o.forwardRef(({className:e,children:t,checked:a,...o},s)=>(0,n.jsxs)(r.H_,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...o,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(r.VF,{children:(0,n.jsx)(l.A,{className:"h-4 w-4"})})}),t]})).displayName=r.H_.displayName,o.forwardRef(({className:e,children:t,...a},o)=>(0,n.jsxs)(r.hN,{ref:o,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(r.VF,{children:(0,n.jsx)(i.A,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=r.hN.displayName;let h=o.forwardRef(({className:e,inset:t,...a},o)=>(0,n.jsx)(r.JU,{ref:o,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a}));h.displayName=r.JU.displayName;let f=o.forwardRef(({className:e,...t},a)=>(0,n.jsx)(r.wv,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t}));f.displayName=r.wv.displayName},59462:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var n=a(82281),o=a(94805);function r(...e){return(0,o.QP)((0,n.$)(e))}},35603:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.d(t,{Ht:()=>x,Kd:()=>b,Lz:()=>g,RX:()=>w,VM:()=>N,zP:()=>_});var o=a(88977);a(98063);var r=a(62545),s=a(44512),l=a(31831),i=a(61482),d=a(58964),c=a.n(d),u=a(87961),m=a(29286),p=a(56215),h=e([r]);r=(h.then?(await h)():h)[0];let E=new TextEncoder().encode(process.env.SESSION_SECRET||"local-dev-secret-change-in-production");async function f(e,t){return await new u.P({sub:e,email:t}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(E)}async function _(e){try{return(await (0,m.V)(e,E)).payload}catch(e){return null}}async function x(){let e=await (0,s.UL)(),t=e.get("session")?.value;if(!t)return null;let a=await _(t);if(!a)return null;let n=await (0,r.KU)();try{await n.query(`SET LOCAL app.current_user_id = '${a.sub}'`);let e=await n.query(`SELECT u.id, u.email, p.tenant_id, p.role, p.full_name, p.is_active
       FROM users u
       JOIN profiles p ON u.id = p.id
       WHERE u.id = $1`,[a.sub]);if(0===e.rows.length)return null;return{user:e.rows[0],userId:a.sub,email:a.email}}finally{n.release()}}async function w(e){let t=await (0,r.KU)();try{if(await t.query("BEGIN"),(await t.query("SELECT id FROM users WHERE email = $1",[e.email])).rows.length>0)return{error:"User with this email already exists"};let a=await c().hash(e.password,10),n=(await t.query(`INSERT INTO users (email, encrypted_password, email_confirmed_at)
       VALUES ($1, $2, NOW())
       RETURNING id`,[e.email,a])).rows[0].id,o=null;if(e.inviteToken)return{error:"Invite functionality not yet implemented"};let r=e.organizationName.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");o=(await t.query(`INSERT INTO tenants (name, slug, is_active)
       VALUES ($1, $2, true)
       RETURNING id`,[`${e.organizationName}`,`${r}-${Date.now()}`])).rows[0].id,await t.query(`INSERT INTO profiles (id, tenant_id, role, full_name, is_active)
       VALUES ($1, $2, $3, $4, true)`,[n,o,"Tenant Admin",e.fullName]),await t.query("COMMIT");let l=await f(n,e.email);return(await (0,s.UL)()).set("session",l,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),(0,i.revalidatePath)("/","layout"),{success:!0}}catch(e){return await t.query("ROLLBACK"),console.error("Signup error:",e),{error:e.message||"An unexpected error occurred during signup"}}finally{t.release()}}async function g(e){let t=await (0,r.KU)();try{let a=await t.query(`SELECT u.id, u.email, u.encrypted_password, p.tenant_id, p.role, p.is_active
       FROM users u
       JOIN profiles p ON u.id = p.id
       WHERE u.email = $1`,[e.email]);if(0===a.rows.length)return{error:"Invalid email or password"};let n=a.rows[0];if(!await c().compare(e.password,n.encrypted_password))return{error:"Invalid email or password"};if(!n.is_active)return{error:"Your account has been deactivated. Please contact your administrator."};let o=await f(n.id,n.email);return(await (0,s.UL)()).set("session",o,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),(0,i.revalidatePath)("/","layout"),{success:!0}}catch(e){return console.error("Signin error:",e),{error:"An unexpected error occurred during signin"}}finally{t.release()}}async function b(){(await (0,s.UL)()).delete("session"),(0,i.revalidatePath)("/","layout"),(0,l.redirect)("/login")}async function N(){let e=await x();if(!e)return null;let t=await (0,r.KU)();try{await t.query(`SET LOCAL app.current_user_id = '${e.userId}'`);let a=await t.query(`SELECT p.*, t.name as tenant_name, t.slug as tenant_slug
       FROM profiles p
       JOIN tenants t ON p.tenant_id = t.id
       WHERE p.id = $1`,[e.userId]);if(0===a.rows.length)return null;return{...a.rows[0],tenant:{id:a.rows[0].tenant_id,name:a.rows[0].tenant_name,slug:a.rows[0].tenant_slug}}}finally{t.release()}}(0,p.D)([_,x,w,g,b,N]),(0,o.A)(_,"40982a859ec3c46a1b6607285e686490468d9e8108",null),(0,o.A)(x,"009a4985819b97b4be2fe1cdb32c9df11877379ad4",null),(0,o.A)(w,"40bd541fc16e4b03c33c1297531f2e89d59c364b4e",null),(0,o.A)(g,"404277a33f7cb0ce1f7247add59deea9a766c2d7db",null),(0,o.A)(b,"007c7f942aadb8dbc8cc2b6b30f60982431f70127f",null),(0,o.A)(N,"0004aa8566c1f3e312cb7f3e3813d6157b8fb58a8b",null),n()}catch(e){n(e)}})},13311:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.d(t,{HB:()=>w,N9:()=>x,ND:()=>c,P4:()=>p,Q1:()=>_,hd:()=>u,mf:()=>f,o2:()=>m,qO:()=>h,xP:()=>g,yW:()=>b});var o=a(88977);a(98063);var r=a(62545),s=a(35603),l=a(31831),i=a(56215),d=e([r,s]);async function c(){let e=await (0,s.Ht)();return e||(0,l.redirect)("/login"),await (0,r.Fh)(e.userId),(await (0,r.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    )
    SELECT 
      CASE 
        WHEN lh.overall_score >= 70 THEN 'Healthy'
        WHEN lh.overall_score >= 40 THEN 'At Risk'
        ELSE 'Critical'
      END as health_category,
      COUNT(*) as count,
      ROUND(100.0 * COUNT(*) / (SELECT COUNT(*) FROM accounts WHERE parent_id IS NULL), 1) as percentage
    FROM latest_health lh
    JOIN accounts a ON lh.account_id = a.id
    WHERE a.parent_id IS NULL
    GROUP BY health_category
    ORDER BY health_category DESC
  `)).rows}async function u(){let e=await (0,s.Ht)();return e||(0,l.redirect)("/login"),await (0,r.Fh)(e.userId),(await (0,r.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    )
    SELECT 
      a.id,
      a.name,
      a.arr,
      lh.overall_score,
      lh.risk_level,
      p.full_name as csm_name
    FROM accounts a
    JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN profiles p ON a.csm_id = p.id
    WHERE a.arr > 100000
      AND lh.overall_score < 50
      AND a.parent_id IS NULL
    ORDER BY a.arr DESC, lh.overall_score ASC
    LIMIT 10
  `)).rows}async function m(e=90){let t=await (0,s.Ht)();return t||(0,l.redirect)("/login"),await (0,r.Fh)(t.userId),(await (0,r.P)(`
    WITH stage_counts AS (
      SELECT 
        DATE(jh.entered_at) as date,
        jh.to_stage as stage,
        COUNT(DISTINCT jh.account_id) as account_count
      FROM journey_history jh
      WHERE jh.entered_at >= NOW() - INTERVAL '${e} days'
      GROUP BY DATE(jh.entered_at), jh.to_stage
    )
    SELECT 
      date,
      stage::text,
      account_count,
      SUM(account_count) OVER (ORDER BY date) as cumulative_count
    FROM stage_counts
    ORDER BY date DESC
    LIMIT 100
  `)).rows}async function p(e){let t=await (0,s.Ht)();t||(0,l.redirect)("/login"),await (0,r.Fh)(t.userId);let a=[],n=[];e?.searchTerm&&(n.push(`%${e.searchTerm}%`),a.push(`a.name ILIKE $${n.length}`)),e?.healthFilter&&("Healthy"===e.healthFilter?a.push("hs.overall_score >= 70"):"At Risk"===e.healthFilter?a.push("hs.overall_score >= 40 AND hs.overall_score < 70"):"Critical"===e.healthFilter&&a.push("hs.overall_score < 40")),e?.stageFilter&&(n.push(e.stageFilter),a.push(`ls.to_stage = $${n.length}`));let o=a.length>0?`AND ${a.join(" AND ")}`:"";return(await (0,r.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, usage_score, engagement_score, support_sentiment_score, adoption_score
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT 
      a.id,
      a.name,
      a.parent_id,
      a.hierarchy_level,
      a.hierarchy_path,
      ls.to_stage as current_stage,
      a.crm_attributes,
      a.status,
      lh.overall_score,
      lh.risk_level,
      lh.usage_score,
      lh.engagement_score,
      lh.support_sentiment_score,
      lh.adoption_score,
      pa.name as parent_name,
      u.email as csm_email,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN accounts pa ON a.parent_id = pa.id
    LEFT JOIN users u ON a.csm_id = u.id
    LEFT JOIN profiles p ON u.id = p.id
    WHERE 1=1 ${o}
    ORDER BY a.hierarchy_level, a.name
  `,n)).rows}async function h(e){let t=await (0,s.Ht)();t||(0,l.redirect)("/login"),await (0,r.Fh)(t.userId);let a=await (0,r.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, usage_score, engagement_score, support_sentiment_score, adoption_score, created_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT 
      a.*,
      lh.overall_score,
      lh.risk_level,
      lh.usage_score,
      lh.engagement_score,
      lh.support_sentiment_score,
      lh.adoption_score,
      lh.created_at as health_updated_at,
      ls.to_stage as current_stage,
      pa.name as parent_name,
      u.email as csm_email,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN accounts pa ON a.parent_id = pa.id
    LEFT JOIN users u ON a.csm_id = u.id
    LEFT JOIN profiles p ON u.id = p.id
    WHERE a.id = $1
  `,[e]);if(0===a.rows.length)return null;let n=await (0,r.P)(`
    WITH latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT a.id, a.name, ls.to_stage as current_stage, a.hierarchy_level
    FROM accounts a
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    WHERE a.parent_id = $1
    ORDER BY a.name
  `,[e]),o=await (0,r.P)(`
    SELECT 
      jh.*,
      u.email as changed_by_email
    FROM journey_history jh
    LEFT JOIN users u ON jh.changed_by = u.id
    WHERE jh.account_id = $1
    ORDER BY jh.entered_at DESC
    LIMIT 10
  `,[e]),i=await (0,r.P)(`
    SELECT *
    FROM usage_metrics
    WHERE account_id = $1
    ORDER BY recorded_at DESC
    LIMIT 30
  `,[e]);return{account:a.rows[0],subsidiaries:n.rows,journey:o.rows,metrics:i.rows}}async function f(){let e=await (0,s.Ht)();return e||(0,l.redirect)("/login"),await (0,r.Fh)(e.userId),(await (0,r.P)(`
    SELECT *
    FROM journey_stages
    ORDER BY display_order
  `)).rows}async function _(){let e=await (0,s.Ht)();e||(0,l.redirect)("/login"),await (0,r.Fh)(e.userId);let t=await (0,r.P)(`
    SELECT DISTINCT ON (id)
      id,
      stage,
      display_order,
      target_duration_days,
      color_hex
    FROM journey_stages
    ORDER BY id, display_order
  `),a=await (0,r.P)(`
    WITH latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage, entered_at
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    ),
    latest_health AS (
      SELECT DISTINCT ON (account_id)
        account_id, overall_score, risk_level, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    )
    SELECT 
      a.id,
      a.name,
      ls.to_stage as current_stage,
      a.arr,
      lh.overall_score,
      lh.risk_level,
      p.full_name as csm_name
    FROM accounts a
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN profiles p ON a.csm_id = p.id
    WHERE a.parent_id IS NULL
    ORDER BY ls.to_stage, a.name
  `);return{stages:t.rows,accounts:a.rows}}async function x(e,t,a){let n=await (0,s.Ht)();n||(0,l.redirect)("/login"),await (0,r.Fh)(n.userId);let o=await (0,r.KU)();try{await o.query("BEGIN");let r=await o.query(`SELECT to_stage FROM journey_history 
       WHERE account_id = $1 
       ORDER BY entered_at DESC 
       LIMIT 1`,[e]),s=r.rows.length>0?r.rows[0].to_stage:null;return s&&await o.query(`
        UPDATE journey_history
        SET exited_at = NOW()
        WHERE account_id = $1 AND to_stage = $2 AND exited_at IS NULL
      `,[e,s]),await o.query(`
      INSERT INTO journey_history (account_id, from_stage, to_stage, changed_by, reason)
      VALUES ($1, $2, $3, $4, $5)
    `,[e,s,t,n.userId,a||"Stage updated via Kanban board"]),await o.query("COMMIT"),{success:!0}}catch(e){throw await o.query("ROLLBACK"),console.error("Error updating account stage:",e),e}finally{o.release()}}async function w(){let e=await (0,s.Ht)();return e||(0,l.redirect)("/login"),await (0,r.Fh)(e.userId),(await (0,r.P)(`
    SELECT 
      p.*,
      COUNT(pe.id) as total_executions,
      COUNT(CASE WHEN pe.executed_at >= NOW() - INTERVAL '7 days' THEN 1 END) as executions_last_7_days,
      MAX(pe.executed_at) as last_executed_at
    FROM playbooks p
    LEFT JOIN playbook_executions pe ON p.id = pe.playbook_id
    WHERE p.is_active = true
    GROUP BY p.id
    ORDER BY p.name
  `)).rows}async function g(e=50){let t=await (0,s.Ht)();return t||(0,l.redirect)("/login"),await (0,r.Fh)(t.userId),(await (0,r.P)(`
    SELECT 
      wq.*,
      p.name as playbook_name,
      a.name as account_name
    FROM webhook_queue wq
    LEFT JOIN playbooks p ON wq.playbook_id = p.id
    LEFT JOIN accounts a ON (wq.payload->>'account_id')::uuid = a.id
    ORDER BY wq.created_at DESC
    LIMIT $1
  `,[e])).rows}async function b(e=5){let t=await (0,s.Ht)();return t||(0,l.redirect)("/login"),await (0,r.Fh)(t.userId),(await (0,r.P)(`
    WITH latest_health AS (
      SELECT DISTINCT ON (account_id) 
        account_id, overall_score, calculated_at
      FROM health_scores
      ORDER BY account_id, calculated_at DESC
    ),
    latest_stage AS (
      SELECT DISTINCT ON (account_id)
        account_id, to_stage, entered_at
      FROM journey_history
      ORDER BY account_id, entered_at DESC
    )
    SELECT
      a.id,
      a.name,
      ls.to_stage as current_stage,
      lh.overall_score,
      ls.entered_at as last_activity
    FROM accounts a
    LEFT JOIN latest_health lh ON a.id = lh.account_id
    LEFT JOIN latest_stage ls ON a.id = ls.account_id
    WHERE a.parent_id IS NULL
    ORDER BY ls.entered_at DESC NULLS LAST
    LIMIT $1
  `,[e])).rows}[r,s]=d.then?(await d)():d,(0,i.D)([c,u,m,p,h,f,_,x,w,g,b]),(0,o.A)(c,"00b79742bcbf00dfdf85e2af52cbbed0924121a839",null),(0,o.A)(u,"00d355824c03bd8e1cb0730e5dd1e86a630707aa5b",null),(0,o.A)(m,"408c42a796b1bf12ec0a4ee124c2f68213455f2758",null),(0,o.A)(p,"402950729f574cd9671c0cabe09d6b2f7bc109631e",null),(0,o.A)(h,"402d0d22c145eada57fb25e0c590e564864c8c79b2",null),(0,o.A)(f,"00dc1677d24c5ceadcc7273a31ef52a63def6788d0",null),(0,o.A)(_,"005425e0a812709ce540c323e485343a1ac42fce8e",null),(0,o.A)(x,"70d502ab1ee2046d48b5b61eec9c7acffedf7bbd95",null),(0,o.A)(w,"00c51daf9dff5a256b21999797c4e988b3e5114375",null),(0,o.A)(g,"40a26f5e0a796fc4965d4d28aa51508a107d704968",null),(0,o.A)(b,"40ac348b21dd335ce9d63d26c1939b25abc541f965",null),n()}catch(e){n(e)}})},83748:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>E});var o=a(62740),r=a(31831),s=a(35603),l=a(13311),i=a(79194),d=a(48413),c=a(90320),u=a(99084),m=a(68228),p=a(45366),h=a(8902),f=a(54917),_=a(20142),x=a(59607),w=a.n(x),g=a(93260),b=a(85),N=e([s,l]);[s,l]=N.then?(await N)():N;let y=[{name:"Executive Dashboard",href:"/dashboard/executive",icon:i.A},{name:"Account360",href:"/dashboard/accounts",icon:d.A},{name:"Customer Journey",href:"/dashboard/journey",icon:c.A},{name:"Integrations",href:"/dashboard/integrations",icon:u.A},{name:"Admin Panel",href:"/dashboard/admin",icon:m.A},{name:"Automation",href:"/dashboard/automation",icon:p.A}];async function E({children:e}){let t=await (0,s.VM)();t||(0,r.redirect)("/login");let a=await (0,l.yW)();return(0,o.jsxs)("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900",children:[(0,o.jsxs)("aside",{className:"w-64 border-r bg-white dark:bg-slate-800 flex flex-col",children:[(0,o.jsxs)("div",{className:"h-16 border-b flex items-center px-6",children:[(0,o.jsx)(h.A,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,o.jsx)("span",{className:"font-bold text-lg",children:"CS Platform"})]}),(0,o.jsxs)("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:[y.map(e=>(0,o.jsxs)(w(),{href:e.href,className:"flex items-center px-3 py-2 text-sm font-medium rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 transition-colors",children:[(0,o.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)),(0,o.jsxs)("div",{className:"pt-6",children:[(0,o.jsx)("div",{className:"px-3 mb-2 flex items-center justify-between",children:(0,o.jsx)("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Recent Accounts"})}),(0,o.jsx)("div",{className:"space-y-1",children:a.map(e=>(0,o.jsxs)(w(),{href:`/dashboard/accounts/${e.id}`,className:"flex items-center px-3 py-2 text-sm rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors group",children:[(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 truncate",children:e.name}),(0,o.jsx)("p",{className:"text-xs text-slate-500 truncate",children:e.current_stage})]}),(0,o.jsx)("div",{className:`ml-2 flex-shrink-0 w-2 h-2 rounded-full ${e.overall_score>=70?"bg-green-500":e.overall_score>=40?"bg-yellow-500":"bg-red-500"}`})]},e.id))})]})]}),(0,o.jsx)("div",{className:"border-t p-4",children:(0,o.jsxs)(g.DropdownMenu,{children:[(0,o.jsx)(g.DropdownMenuTrigger,{asChild:!0,children:(0,o.jsxs)("button",{className:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[(0,o.jsxs)("div",{className:"flex-1 text-left",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:t.full_name}),(0,o.jsx)("p",{className:"text-xs text-slate-500",children:t.role})]}),(0,o.jsx)(f.A,{className:"h-4 w-4 text-slate-400"})]})}),(0,o.jsxs)(g.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,o.jsx)(g.DropdownMenuLabel,{children:(0,o.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,o.jsx)("p",{className:"text-sm font-medium",children:t.full_name}),(0,o.jsx)("p",{className:"text-xs text-muted-foreground",children:t.tenant?.name})]})}),(0,o.jsx)(g.DropdownMenuSeparator,{}),(0,o.jsx)(g.DropdownMenuItem,{asChild:!0,children:(0,o.jsx)("form",{action:s.Kd,className:"w-full",children:(0,o.jsxs)("button",{type:"submit",className:"flex items-center w-full",children:[(0,o.jsx)(_.A,{className:"mr-2 h-4 w-4"}),(0,o.jsx)("span",{children:"Sign out"})]})})})]})]})})]}),(0,o.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,o.jsxs)("header",{className:"h-16 border-b bg-white dark:bg-slate-800 flex items-center px-6",children:[(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsx)(b.CommandPalette,{})}),(0,o.jsx)("div",{className:"ml-4",children:(0,o.jsxs)("div",{className:"flex items-center px-3 py-1.5 text-sm bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-md",children:[(0,o.jsx)(h.A,{className:"h-4 w-4 mr-2"}),t.tenant?.name]})})]}),(0,o.jsx)("main",{className:"flex-1 overflow-y-auto",children:e})]})]})}n()}catch(e){n(e)}})},19611:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l,metadata:()=>s});var n=a(62740),o=a(59258),r=a.n(o);a(82704);let s={title:"Customer Success Platform",description:"Multi-tenant Customer Success Platform with RLS"};function l({children:e}){return(0,n.jsx)("html",{lang:"en",children:(0,n.jsx)("body",{className:r().className,children:e})})}},85:(e,t,a)=>{"use strict";a.d(t,{CommandPalette:()=>n});let n=(0,a(46760).registerClientReference)(function(){throw Error("Attempted to call CommandPalette() from the server but CommandPalette is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/command-palette.tsx","CommandPalette")},93260:(e,t,a)=>{"use strict";a.d(t,{DropdownMenu:()=>o,DropdownMenuContent:()=>s,DropdownMenuItem:()=>l,DropdownMenuLabel:()=>i,DropdownMenuSeparator:()=>d,DropdownMenuTrigger:()=>r});var n=a(46760);let o=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenu() from the server but DropdownMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenu"),r=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuTrigger() from the server but DropdownMenuTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuTrigger"),s=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuContent() from the server but DropdownMenuContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuContent"),l=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuItem() from the server but DropdownMenuItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuItem");(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuCheckboxItem() from the server but DropdownMenuCheckboxItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuCheckboxItem"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuRadioItem() from the server but DropdownMenuRadioItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuRadioItem");let i=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuLabel() from the server but DropdownMenuLabel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuLabel"),d=(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSeparator() from the server but DropdownMenuSeparator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuSeparator");(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuShortcut() from the server but DropdownMenuShortcut is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuShortcut"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuGroup() from the server but DropdownMenuGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuGroup"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuPortal() from the server but DropdownMenuPortal is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuPortal"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSub() from the server but DropdownMenuSub is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuSub"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSubContent() from the server but DropdownMenuSubContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuSubContent"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuSubTrigger() from the server but DropdownMenuSubTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuSubTrigger"),(0,n.registerClientReference)(function(){throw Error("Attempted to call DropdownMenuRadioGroup() from the server but DropdownMenuRadioGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Volumes/Extreme SSD/Aro Desk/components/ui/dropdown-menu.tsx","DropdownMenuRadioGroup")},62545:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.d(t,{Fh:()=>i,KU:()=>l,P:()=>s});var o=a(64939),r=e([o]);let d=new(o=(r.then?(await r)():r)[0]).Pool({connectionString:process.env.DATABASE_URL,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});async function s(e,t){let a=Date.now();try{let n=await d.query(e,t),o=Date.now()-a;return console.log("Executed query",{text:e,duration:o,rows:n.rowCount}),n}catch(e){throw console.error("Database query error:",e),e}}async function l(){return d.connect()}async function i(e,t){let a=`SET LOCAL app.current_user_id = '${e}'`;t?await t.query(a):await s(a)}n()}catch(e){n(e)}})},82704:()=>{}};